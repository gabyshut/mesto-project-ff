(()=>{"use strict";var t="https://mesto.nomoreparties.co/v1/wff-cohort-33",e="3290a9e1-f90c-4d2a-b987-c7be46e492fd",n="application/json";function o(t){return t.ok?t.json():Promise.reject("Что-то пошло не так. Ошибка ".concat(t.status))}function r(n){return fetch("".concat(t).concat(n),{headers:{authorization:e}}).then((function(t){return o(t)})).catch((function(t){console.log(t)}))}var c=document.querySelector("#card-template").content;function u(t,e,n,o,r){var u=c.firstElementChild.cloneNode(!0),i=u.querySelector(".card__image"),a=u.querySelector(".card__title"),s=u.querySelector(".card__delete-button"),l=u.querySelector(".card__like-button"),p=u.querySelector(".card__like-counter");return i.setAttribute("src",t.link),i.setAttribute("alt",t.name),a.textContent=t.name,p.textContent=t.likes.length,t.likes.some((function(t){return t._id===e}))&&l.classList.add("card__like-button_is-active"),t.owner._id===e?s.addEventListener("click",(function(){return n(t._id,u)})):s.classList.add("card__delete-button_disabled"),i.addEventListener("click",(function(){return r(t)})),l.addEventListener("click",(function(){return o(t,l,p)})),u}function i(r,c){(function(r){return fetch("".concat(t,"/cards/").concat(r),{method:"DELETE",headers:{authorization:e,"Content-Type":n}}).then((function(t){return o(t)})).catch((function(t){console.log(t)}))})(r).then((function(t){c.remove()})).catch((function(t){console.log(t)}))}function a(r,c,u){var i=c.classList.contains("card__like-button_is-active")?"DELETE":"PUT";(function(r,c){return fetch("".concat(t,"/cards/likes/").concat(r),{method:c,headers:{authorization:e,"Content-Type":n}}).then((function(t){return o(t)})).catch((function(t){console.log(t)}))})(r._id,i).then((function(t){c.classList.toggle("card__like-button_is-active"),u.textContent=t.likes.length})).catch((function(t){console.log(t)}))}function s(t){t.classList.add("popup_is-animated"),setTimeout((function(){t.classList.add("popup_is-opened")}),10),document.addEventListener("keyup",p)}function l(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keyup",p)}function p(t){"Escape"===t.key&&l(document.querySelector(".popup_is-opened"))}function d(t,e,n){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}function f(t,e){t.classList.add(e.inactiveButtonClass),t.disabled=!0}function m(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?function(t,e){t.classList.remove(e.inactiveButtonClass),t.disabled=!1}(e,n):f(e,n)}function _(t,e){Array.from(t.querySelectorAll(e.inputSelector)).forEach((function(n){d(t,n,e)}))}r("/users/me");var y={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input-error_active",errorClass:"popup__error_visible"};function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=Array(e);n<e;n++)o[n]=t[n];return o}var v,S,b=document.querySelector(".places__list"),g=document.querySelector(".popup_type_edit"),L=document.querySelector(".popup_type_new-card"),q=document.querySelector(".popup_type_image"),C=document.querySelector(".popup__image"),E=document.querySelector(".popup__caption"),A=document.querySelector(".popup_type_change-avatar"),k=document.querySelector(".profile__title"),x=document.querySelector(".profile__description"),T=document.querySelector('.popup__form[name="edit-profile"]'),w=document.querySelector(".popup__input_type_name"),B=document.querySelector(".popup__input_type_description"),z=document.querySelector(".popup__input_type_card-name"),j=document.querySelector(".popup__input_type_url"),O=document.querySelector('.popup__form[name="new-place"]'),D=document.querySelector('.popup__form[name="change-avatar"]'),P=document.querySelector(".profile__image");function N(t){C.setAttribute("src",t.link),C.setAttribute("alt",t.name),E.textContent=t.name,s(q)}function I(){r("/users/me").then((function(t){k.textContent=t.name,x.textContent=t.about,P.setAttribute("src",t.avatar)})).catch((function(t){console.log("Не удалось получить информацию о пользователе. Ошибка: ".concat(t))}))}function J(t){var e=t.buttonElement,n=t.isLoading;e.textContent=n?"Сохранение...":"Сохранить"}v=[fetch("".concat(t,"/cards"),{headers:{authorization:e}}).then((function(t){return o(t)})).catch((function(t){console.log(t)})),r("/users/me")],Promise.all(v).then((function(t){var e,n,o=(n=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var o,r,c,u,i=[],a=!0,s=!1;try{if(c=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;a=!1}else for(;!(a=(o=c.call(n)).done)&&(i.push(o.value),i.length!==e);a=!0);}catch(t){s=!0,r=t}finally{try{if(!a&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(s)throw r}}return i}}(e,n)||function(t,e){if(t){if("string"==typeof t)return h(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?h(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),r=o[0],c=o[1];r.forEach((function(t){b.append(u(t,c._id,i,a,N))}))})).catch((function(t){console.log("Не удалось получить информацию о карточках или пользователях. Ошибка: ".concat(t))})),I(),document.addEventListener("mousedown",(function(t){t.target.classList.contains("profile__edit-button")&&(I(),w.value=k.textContent,B.value=x.textContent,_(T,y),s(g),p(g)),t.target.classList.contains("profile__add-button")&&(s(L),p(L),_(O,y),O.reset()),(t.target.classList.contains("profile__image-container")||t.target.classList.contains("profile__image-edit"))&&(s(A),p(A),_(A.querySelector(".popup__form"),y),A.querySelector(".popup__form").reset()),function(t){(t.target.classList.contains("popup__close")||t.target.classList.contains("popup"))&&l(t.target.closest(".popup"))}(t)})),T.addEventListener("submit",(function(r){r.preventDefault();var c,u,i=T.querySelector(y.submitButtonSelector);J({buttonElement:i,isLoading:!0}),(c=w.value,u=B.value,fetch("".concat(t,"/users/me"),{method:"PATCH",headers:{authorization:e,"Content-Type":n},body:JSON.stringify({name:c,about:u})}).then((function(t){return o(t)})).catch((function(t){console.log("Не удалось обновить данные пользователя. Ошибка ".concat(t))}))).then((function(t){k.textContent=t.name,x.textContent=t.about,l(g)})).catch((function(t){console.log("Не удалось обновить данные пользователя. Ошибка ".concat(t))})).finally((function(){J({buttonElement:i,isLoading:!1})}))})),O.addEventListener("submit",(function(r){r.preventDefault();var c,s,p=O.querySelector(y.submitButtonSelector);J({buttonElement:p,isLoading:!0}),(c=z.value,s=j.value,fetch("".concat(t,"/cards"),{method:"POST",headers:{authorization:e,"Content-Type":n},body:JSON.stringify({name:c,link:s})}).then((function(t){return o(t)})).catch((function(t){console.log(t)}))).then((function(t){var e=u(t,t.owner._id,i,a,N);b.prepend(e),l(document.querySelector(".popup_is-opened")),O.reset(),f(p,y)})).catch((function(t){console.log("Не удалось создать карточку. Ошибка: ".concat(t))})).finally((function(){J({buttonElement:p,isLoading:!1})}))})),D.addEventListener("submit",(function(r){r.preventDefault();var c,u=D.querySelector(y.submitButtonSelector);J({buttonElement:u,isLoading:!0}),(c=D.querySelector(".popup__input").value,fetch("".concat(t,"/users/me/avatar"),{method:"PATCH",headers:{authorization:e,"Content-Type":n},body:JSON.stringify({avatar:c})}).then((function(t){return o(t)})).catch((function(t){console.log(t)}))).then((function(t){P.setAttribute("src",t.avatar),l(A),D.reset(),f(D.querySelector(y.submitButtonSelector),y)})).catch((function(t){console.log("Не удалось обновить аватар. Ошибка: ".concat(t))})).finally((function(){J({buttonElement:u,isLoading:!1})}))})),S=y,Array.from(document.querySelectorAll(S.formSelector)).forEach((function(t){t.addEventListener("submit",(function(t){t.preventDefault()})),function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);m(n,o,e),n.forEach((function(r){r.addEventListener("input",(function(){!function(t,e,n){e.setCustomValidity(""),e.hasAttribute("data-no-regex")||/^[a-zA-Zа-яА-ЯёЁ\- ]+$/.test(e.value)||""===e.value?e.setCustomValidity(""):e.setCustomValidity(e.dataset.errorMessage),e.validity.valid?d(t,e,n):function(t,e,n,o){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(t,e,e.validationMessage,n)}(t,r,e),m(n,o,e)}))}))}(t,S)}))})();