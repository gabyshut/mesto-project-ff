(()=>{"use strict";var t="https://mesto.nomoreparties.co/v1/wff-cohort-33",e="3290a9e1-f90c-4d2a-b987-c7be46e492fd",n="application/json";function o(t){return t.ok?t.json():Promise.reject("Что-то пошло не так. Ошибка ".concat(t.status))}var r=document.querySelector("#card-template").content;function u(t,e,n,o,u){var c=r.firstElementChild.cloneNode(!0),i=c.querySelector(".card__image"),a=c.querySelector(".card__title"),l=c.querySelector(".card__delete-button"),s=c.querySelector(".card__like-button"),d=c.querySelector(".card__like-counter");return i.setAttribute("src",t.link),i.setAttribute("alt",t.name),a.textContent=t.name,d.textContent=t.likes.length,t.likes.some((function(t){return t._id===e}))&&s.classList.add("card__like-button_is-active"),t.owner._id===e?l.addEventListener("click",(function(){return n(t._id,c)})):l.classList.add("card__delete-button_disabled"),i.addEventListener("click",(function(){return u(t)})),s.addEventListener("click",(function(){return o(t,s,d)})),c}function c(r,u){(function(r){return fetch("".concat(t,"/cards/").concat(r),{method:"DELETE",headers:{authorization:e,"Content-Type":n}}).then((function(t){return o(t)}))})(r).then((function(t){u.remove()})).catch((function(t){console.log(t)}))}function i(r,u,c){var i=u.classList.contains("card__like-button_is-active")?"DELETE":"PUT";(function(r,u){return fetch("".concat(t,"/cards/likes/").concat(r),{method:u,headers:{authorization:e,"Content-Type":n}}).then((function(t){return o(t)}))})(r._id,i).then((function(t){u.classList.toggle("card__like-button_is-active"),c.textContent=t.likes.length})).catch((function(t){console.log(t)}))}function a(t){t.classList.add("popup_is-animated"),setTimeout((function(){t.classList.add("popup_is-opened")}),10),document.addEventListener("keyup",d)}function l(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keyup",d)}function s(t){(t.target.classList.contains("popup__close")||t.target.classList.contains("popup"))&&l(t.target.closest(".popup"))}function d(t){"Escape"===t.key&&l(document.querySelector(".popup_is-opened"))}function p(t,e,n){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}function f(t,e){t.classList.add(e.inactiveButtonClass),t.disabled=!0}function m(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?function(t,e){t.classList.remove(e.inactiveButtonClass),t.disabled=!1}(e,n):f(e,n)}var _={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input-error_active",errorClass:"popup__error_visible"};function y(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=Array(e);n<e;n++)o[n]=t[n];return o}var v,h=document.querySelector(".places__list"),S=document.querySelector(".popup_type_edit"),b=document.querySelector(".popup_type_new-card"),q=document.querySelector(".popup_type_image"),g=document.querySelector(".popup__image"),E=document.querySelector(".popup__caption"),L=document.querySelector(".popup_type_change-avatar"),C=document.querySelector(".profile__title"),A=document.querySelector(".profile__description"),k=document.querySelector('.popup__form[name="edit-profile"]'),x=document.querySelector(".popup__input_type_name"),T=document.querySelector(".popup__input_type_description"),w=document.querySelector(".popup__input_type_card-name"),B=document.querySelector(".popup__input_type_url"),z=document.querySelector('.popup__form[name="new-place"]'),j=document.querySelector('.popup__form[name="change-avatar"]'),O=document.querySelector(".profile__image"),D=[fetch("".concat(t,"/cards"),{headers:{authorization:e}}).then((function(t){return o(t)})),fetch("".concat(t).concat("/users/me"),{headers:{authorization:e}}).then((function(t){return o(t)}))],P=document.querySelector(".profile__edit-button"),N=document.querySelector(".profile__add-button"),I=document.querySelector(".profile__image-container"),J=document.querySelectorAll(".popup");function M(t){g.setAttribute("src",t.link),g.setAttribute("alt",t.name),E.textContent=t.name,a(q)}function V(t){var e=t.buttonElement,n=t.isLoading;e.textContent=n?"Сохранение...":"Сохранить"}function H(t,e){a(t),function(t,e){Array.from(t.querySelectorAll(e.inputSelector)).forEach((function(n){p(t,n,e)}))}(e,_)}Promise.all(D).then((function(t){var e,n,o=(n=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var o,r,u,c,i=[],a=!0,l=!1;try{if(u=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;a=!1}else for(;!(a=(o=u.call(n)).done)&&(i.push(o.value),i.length!==e);a=!0);}catch(t){l=!0,r=t}finally{try{if(!a&&null!=n.return&&(c=n.return(),Object(c)!==c))return}finally{if(l)throw r}}return i}}(e,n)||function(t,e){if(t){if("string"==typeof t)return y(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?y(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),r=o[0],a=o[1];r.forEach((function(t){var e;h.append(u(t,a._id,c,i,M)),e=a,C.textContent=e.name,A.textContent=e.about,O.setAttribute("src",e.avatar)}))})).catch((function(t){console.log("Не удалось получить информацию о карточках или пользователях. Ошибка: ".concat(t))})),P.addEventListener("mousedown",(function(){x.value=C.textContent,T.value=A.textContent,H(S,k)})),N.addEventListener("mousedown",(function(){H(b,z)})),I.addEventListener("mousedown",(function(){H(L,L.querySelector(".popup__form"))})),J.forEach((function(t){t.addEventListener("click",s)})),k.addEventListener("submit",(function(r){r.preventDefault();var u,c,i=k.querySelector(_.submitButtonSelector);V({buttonElement:i,isLoading:!0}),(u=x.value,c=T.value,fetch("".concat(t,"/users/me"),{method:"PATCH",headers:{authorization:e,"Content-Type":n},body:JSON.stringify({name:u,about:c})}).then((function(t){return o(t)}))).then((function(t){C.textContent=t.name,A.textContent=t.about,l(S)})).catch((function(t){console.log("Не удалось обновить данные пользователя. Ошибка ".concat(t))})).finally((function(){V({buttonElement:i,isLoading:!1})}))})),z.addEventListener("submit",(function(r){r.preventDefault();var a,s,d=z.querySelector(_.submitButtonSelector);V({buttonElement:d,isLoading:!0}),(a=w.value,s=B.value,fetch("".concat(t,"/cards"),{method:"POST",headers:{authorization:e,"Content-Type":n},body:JSON.stringify({name:a,link:s})}).then((function(t){return o(t)}))).then((function(t){var e=u(t,t.owner._id,c,i,M);h.prepend(e),l(document.querySelector(".popup_is-opened")),z.reset(),f(d,_)})).catch((function(t){console.log("Не удалось создать карточку. Ошибка: ".concat(t))})).finally((function(){V({buttonElement:d,isLoading:!1})}))})),j.addEventListener("submit",(function(r){r.preventDefault();var u,c=j.querySelector(_.submitButtonSelector);V({buttonElement:c,isLoading:!0}),(u=j.querySelector(".popup__input").value,fetch("".concat(t,"/users/me/avatar"),{method:"PATCH",headers:{authorization:e,"Content-Type":n},body:JSON.stringify({avatar:u})}).then((function(t){return o(t)}))).then((function(t){O.setAttribute("src",t.avatar),l(L),j.reset(),f(j.querySelector(_.submitButtonSelector),_)})).catch((function(t){console.log("Не удалось обновить аватар. Ошибка: ".concat(t))})).finally((function(){V({buttonElement:c,isLoading:!1})}))})),v=_,Array.from(document.querySelectorAll(v.formSelector)).forEach((function(t){t.addEventListener("submit",(function(t){t.preventDefault()})),function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);m(n,o,e),n.forEach((function(r){r.addEventListener("input",(function(){!function(t,e,n){e.setCustomValidity(""),e.hasAttribute("data-no-regex")||/^[a-zA-Zа-яА-ЯёЁ\- ]+$/.test(e.value)||""===e.value?e.setCustomValidity(""):e.setCustomValidity(e.dataset.errorMessage),e.validity.valid?p(t,e,n):function(t,e,n,o){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(t,e,e.validationMessage,n)}(t,r,e),m(n,o,e)}))}))}(t,v)}))})();